<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Switching a Datastore Provider | CluedIn Documentation</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="Switching a Datastore Provider" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CluedIn ships with many different datastore implementations. This gives you a choice on what system will host your data. It may be that you would rather use PostGres or MySQL than SQL Server for the Relational Store. It maybe that you would like to use a cloud SQL provider via PAAS. The Datastore abstraction layer allows you to support this change." />
<meta property="og:description" content="CluedIn ships with many different datastore implementations. This gives you a choice on what system will host your data. It may be that you would rather use PostGres or MySQL than SQL Server for the Relational Store. It maybe that you would like to use a cloud SQL provider via PAAS. The Datastore abstraction layer allows you to support this change." />
<link rel="canonical" href="https://documentation.cluedin.net//https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/40-Datastores/Switching%20a%20Datastore%20Provider.html" />
<meta property="og:url" content="https://documentation.cluedin.net//https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/40-Datastores/Switching%20a%20Datastore%20Provider.html" />
<meta property="og:site_name" content="CluedIn Documentation" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-05T18:42:43+00:00" />
<script type="application/ld+json">
{"datePublished":"2021-09-05T18:42:43+00:00","url":"https://documentation.cluedin.net//https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/40-Datastores/Switching%20a%20Datastore%20Provider.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://documentation.cluedin.net//https://documentation.cluedin.net/versions/3.2.3/siteicon.png"}},"description":"CluedIn ships with many different datastore implementations. This gives you a choice on what system will host your data. It may be that you would rather use PostGres or MySQL than SQL Server for the Relational Store. It maybe that you would like to use a cloud SQL provider via PAAS. The Datastore abstraction layer allows you to support this change.","headline":"Switching a Datastore Provider","dateModified":"2021-09-05T18:42:43+00:00","@type":"Article","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="https://documentation.cluedin.net//https://documentation.cluedin.net/versions/3.2.3/feed.xml" title="CluedIn Documentation" />
		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="https://documentation.cluedin.net/versions/3.2.3/css/main.css">
		<link rel="apple-touch-icon" href="https://documentation.cluedin.net/versions/3.2.3/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="https://documentation.cluedin.net/versions/3.2.3/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="https://documentation.cluedin.net/versions/3.2.3/images/favicon.png">
		<script src="https://kit.fontawesome.com/53f65601e3.js" crossorigin="anonymous"></script>

		
    <link rel="stylesheet" href="https://documentation.cluedin.net/versions/3.2.3/css/prism.css">
    <!-- Start of HubSpot Embed Code -->
  <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/2770606.js"></script>
<!-- End of HubSpot Embed Code -->
	</head>

	<body>
		<header>
			<h1>
				<a href="https://documentation.cluedin.net/versions/3.2.3/"><img src="https://documentation.cluedin.net/versions/3.2.3/images/cluedin-logo-c.svg" width="40" height="40" alt="CluedIn Documentation logo"></a>
				CluedIn Documentation
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="https://documentation.cluedin.net/versions/3.2.3/search.html" method="get">
				<input type="text" name="q" id="search-input" placeholder="Type to search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav >
				<ul>
					<li class="nav-item top-level ">
						
						<a href="https://documentation.cluedin.net/versions/3.2.3/">What is CluedIn</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/00-gettingStarted/ssl.html">Get Started</a>
							<ul>
								
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/00-gettingStarted/1-default.html">CluedIn Overview</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/00-gettingStarted/30-docker-local.html">CluedIn with Docker</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/00-gettingStarted/40-kubernetes.html">CluedIn with Kubernetes</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/00-gettingStarted/81-home-dashboard.html">Home Dashboard</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/00-gettingStarted/90-frequently-asked-questions.html">Frequently asked questions</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/00-gettingStarted/Running%20CluedIn%20Efficiently.html">Running CluedIn Efficiently for Cost</a></li>
									
								
									
								
									
								
									
								
									
								
									
								
									
								
									
								
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/00-gettingStarted/0-Welcome-to-CluedIn.html">Welcome to CluedIn</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/50-Consume/Generating%20an%20API%20Token.html">Administration</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/50-Consume/Generating%20an%20API%20Token.html">Generating an API Token</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/05-Administration/20-Users/Adding%20Team%20Members.html">Users</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/05-Administration/30-Authentication/index.html">Authentication</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/05-Administration/40-Theme/index.html">Theme</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/05-Administration/60-Accounts_Multitenancy/0-index.html">Multitenancy</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/05-Administration/70-Removing_data/index.html">Removing data</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/05-Administration/80-Upgrading%20CluedIn/index.html">Changing versions</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/05-Administration/90-Backup_Restore/index.html">Backup and Restore</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/05-Administration/10-Profile/index.html">Profile</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/modify-integration.html">Integration</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/modify-integration.html">Modify an Integration</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/Crawling.html">Crawling</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/Help%20with%20building%20robust%20integrations.html">Help with building robust integrations</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/Home%20Screen.html">Home Screen</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/Push%20data%20to%20CluedIn.html">Push Data to CluedIn</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/add-integration.html">How to add an Integration</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/build-enricher.html">Build Enricher</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/build-integration.html">Build Integration</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/delta-crawls.html">Delta Crawls</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/install-integration.html">Install Integration</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/integration-compatible-with-UI.html">Integration and the CluedIn UI</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/10-Integration/0-index.html">What are integrations</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/entity-setup.html">Preparation</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/entity-setup.html">Entity Type and UI</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/CluedIn-Connect/CluedIn%20Connect.html">CluedIn Connect</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/Data-Metrics/10-Data-Quality-Metrics.html">Data Quality Metrics</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/Data-Metrics/20-Most-Used-Data-Quality-Metrics.html">Most Used Data Quality Metrics</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/Data-Metrics/30-How-To-Add-a-Data-Quality-Metric.html">How to add a new Data Quality Metric</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/Data-Metrics/40-Data-Quality-Metrics-Explanations.html">Data Quality Metric Explanations</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/Engine-Room/Engine%20Room.html">Engine Room</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/Entity-Types/Entity%20Type%20Translation.html">Entity Type Translation</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/Shadow-Entities/Shadow%20Entities.html">Shadow Entities</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/20-Preparation/Aggregate/Aggregation.html">Aggregation</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/30-Manipulation/10-Data_Training/CluedIn%20Train.html">Manipulation</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/30-Manipulation/10-Data_Training/CluedIn%20Train.html">CluedIn Train</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/30-Manipulation/20-Data_Cleaning/CluedIn%20Clean.html">CluedIn Clean</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/30-Manipulation/30-Merging_Records/Fuzzy%20Merging%20Explained.html">Fuzzy Merging Explained</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/30-Manipulation/30-Merging_Records/Merging%20Records.html">Merging Records</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/30-Manipulation/40-Mesh_Center/Mesh%20Center.html">Mesh Center</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/30-Manipulation/50-Splitting_Records/Splitting%20Records.html">Splitting Records</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/30-Manipulation/index.html">Transforming Data</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Subject-Access-Requests/Subject%20Access%20Requests.html">Governance</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Subject-Access-Requests/Subject%20Access%20Requests.html">Subject Access Requests</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Consent-Management/Consent%20Management.html">Consent Management</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Data-Breaches/Data%20Breaches.html">Data Breaches</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Data-Catalog/Data%20Catalog.html">Data Catalog</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Data-Glossary/Data%20Glossary.html">Data Glossary</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Data-Policies/Data%20Policies.html">Data Policies</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Data-Privacy/Data%20Privacy.html">Data Privacy</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Data-Retention/Data%20Retention.html">Data Retention</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Governance.html">Data Governance</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Mesh-API/Mesh%20API.html">Mesh API</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/40-Governance/Access-Control/Access%20Control.html">Access Control</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/60-Management/Duplicate%20List.html">Management</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/60-Management/Duplicate%20List.html">Duplicate List</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/60-Management/Rules/Rules.html">Rules</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/DeveloperPortal.html">Developer</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/DeveloperPortal.html">Developer Portal</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/10-Administration_Operations/Administration%20Operations.html">Administration Operations</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/100-Logging/Building%20a%20new%20Logging%20Provider.html">Building a new Logging Provider</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Change%20Verbs.html">Change Verbs</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Clue.html">Clue</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Core%20Vocabularies.html">Core Vocabularies</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Data%20Part.html">Data Part</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Dynamic%20Vocabularies.html">Dynamic Vocabularies</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Edge%20Types.html">Edge Types</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Edges.html">Edges</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Entity%20Codes.html">Entity Codes</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Entity%20Type.html">Entity Type</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Entity%20Types/Infrastructure%20User%20Entity%20Type.html">Infrastructure User Entity Type</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Entity%20Types/Organization%20Entity%20Type.html">Organization Entity Type</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Entity%20Types/Person%20Entity%20Type.html">Person Entity Type</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Entity.html">Entity</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Origin.html">Origin</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Vocabularies.html">Vocabularies</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Vocabularies/Organization%20Vocaulary.html">Organization Vocaulary</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Vocabularies/Person%20Vocabulary.html">Person Vocabulary</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Vocabulary%20Groupings.html">Vocabulary Groupings</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/110-Object_Model/Vocabulary%20Values.html">Vocabulary Values</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/120-Other/Common%20Design%20Decisions.html">Common Design Decisions</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/120-Other/Common%20Problems.html">Common Problems</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/130-Parent_Aggregation/Parent%20Aggregation.html">Parent Aggregation</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/140-Preview_Image/Setting%20a%20Preview%20Image%20for%20a%20Clue.html">Setting a Preview Image for a Clue</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Adding%20a%20new%20Processing%20Pipeline.html">Adding a new Processing Pipeline</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/CluedIn%20Performance%20Metrics.html">CluedIn Performance Metrics</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Extending%20an%20Existing%20Pipeline%20Process.html">Extending an Existing Pipeline Process</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Ignoring%20Insignificant%20Changes.html">Ignoring Insignificant Changes</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Jobs/Agent%20Jobs.html">Agent Jobs</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Processing%20Pipeline%20Overview.html">Processing Pipeline Overview</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Processing%20Stages/Adding%20a%20Preprocessor.html">Adding a new PreProcessor</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Processing%20Stages/Adding%20a%20new%20IProcessingFilter.html">Adding a new IProcessingFilter</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Processing%20Stages/Adding%20an%20IDataPartProcessorExecutor.html">Adding an IDataPartProcessor</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Processing%20Stages/Adding%20an%20IEntityTypeProcessor.html">Adding an IEntityTypeProcessor</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Processing%20Stages/Adding%20an%20IMergePreProcessor.html">Adding an IMergePreProcessor</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Turning%20Clues%20into%20ProcessedEntityMetadata.html">Turning Clues into ProcessedEntityMetadata</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/150-Processing/Workflows/Workflow%20Event%20Handlers.html">Workflow Event Handlers</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/170-Thumbnail_Extractors/Thumbnail%20Extractors.html">Thumbnail Extractors</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/20-Configuration/Changing%20Configuration%20Settings.html">Changing Configuration Settings</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/30-Content_Extraction/Content%20Extractors.html">Content Extractors</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/30-Content_Extraction/Downloading%20a%20File%20and%20Indexing%20the%20Content.html">Downloading a File and Indexing the Content</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/33-Commands/Commands.html">Commands</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/40-Datastores/Adding%20a%20new%20Datastore%20Provider.html">Adding a new Datastore Provider</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/40-Datastores/Datastores.html">Datastores</a></li>
									
								
									
										<li class="nav-item current"><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/40-Datastores/Switching%20a%20Datastore%20Provider.html">Switching a Datastore Provider</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/50-Events/Events.html">Events</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/60-External_Search/Deploying%20a%20New%20External%20Search%20Provider.html">Deploying a New External Search Provider</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/60-External_Search/External%20Search%20Providers.html">External Search Providers</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/70-Integration_Pattern/Eventual%20Connectivity.html">Eventual Connectivity</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/80-Integrity_Checks/Validate%20Server%20Heatlh.html">Validate Server Heatlh</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/90-Jobs/One%20Time%20Jobs.html">One Time Jobs</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/90-Jobs/Recurring%20Jobs.html">Recurring Jobs</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/90-Jobs/Scheduled%20Jobs.html">Scheduled Jobs</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/60-Management/Modelling/Modelling.html">Modelling</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/U-User-Interface/User%20Interface.html">User Interface</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/U-User-Interface/User%20Interface.html">User Interface</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/180-User_Interface/Customisations/Searching%20for%20data.html">Searching for data</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/180-User_Interface/Customisations/Suggested%20Searches.html">Suggested Searches</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/190-Webhooks/Webhooks.html">Webhooks</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/U-User-Interface/Entity-Page/All%20Properties.html">All Properties</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/U-User-Interface/Entity-Page/Entity%20Page.html">Entity Page</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/U-User-Interface/Entity-Page/History.html">History</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/U-User-Interface/Entity-Page/Pending%20Changes.html">Pending Changes</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/U-User-Interface/Followed-Entities/Followed%20Entities.html">Followed Entities</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/U-User-Interface/Keep-in-the-loop/Keep%20in%20the%20loop.html">Keep in the loop</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/180-User_Interface/Customisations/Adding%20new%20Search%20Filters.html">Adding new Search Filters</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/55-Rules/Developing%20with%20Rules.html">Rules</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/91-Developer-Portal/55-Rules/Developing%20with%20Rules.html">Developing with Rules</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/98-upgrade-path/upgrade-23-to-24.html">Upgrade</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/98-upgrade-path/upgrade-23-to-24.html">From V2.3.x to V.2.4.x</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/99-releaseNotes/0-index.html">Release notes</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/99-releaseNotes/0-index.html">Handy Links</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/Crawler/Agents/Using%20Agents.html">Crawler</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/Crawler/Agents/Using%20Agents.html">Using Agents</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/Crawler/Crawler%20Validation%20Framework.html">Crawler Validation Framework</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/Crawler/Deploying%20a%20New%20Crawler.html">Deploying a New Crawler</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/Crawler/Mapping%20Encryption%20Levels%20and%20Integration%20Location.html">Mapping Encryption Levels and Integration Locations</a></li>
									
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Search/Running%20Searches.html">Consume</a>
							<ul>
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Search/Running%20Searches.html">Running Searches</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Data-Marts/Data%20Marts.html">Data Marts</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Export-Targets/Export%20Targets.html">Export Targets</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Graphql/Add%20GraphQL%20Entity%20Type%20Resolvers.html">Add GraphQL Entity Type Resolvers</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Graphql/GraphQL%20Actions.html">GraphQL Actions</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Graphql/GraphQL.html">GraphQL</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Outgoing-Streams/Outgoing%20Streams.html">Streams</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Rest-API/Rest%20API.html">Rest API</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Search/Configuration%20Search%20Relevance.html">Configuration Search Relevance</a></li>
									
								
									
										<li class="nav-item "><a href="https://documentation.cluedin.net/versions/3.2.3/docs/H-Consume/Consume.html">Consume</a></li>
									
								
							</ul>
						</li>
					
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>Developer</h2>
				<h3>Switching a Datastore Provider</h3>
			</div>
			<main>
			<article class="content">
				<p>CluedIn ships with many different datastore implementations. This gives you a choice on what system will host your data. It may be that you would rather use PostGres or MySQL than SQL Server for the Relational Store. It maybe that you would like to use a cloud SQL provider via PAAS. The Datastore abstraction layer allows you to support this change.</p>

<p>To change your implementation of a particular store requires two pieces:</p>

<p>1: Implementing the IDataStore interface and the specific provider interface you would like to implement e.g. IRelationalDataStore.</p>

<p>2: Injecting your new implementation into the Container of CluedIn.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data.Entity</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data.Entity.Core</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data.Entity.Infrastructure</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data.SqlClient</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq.Expressions</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">CluedIn.Core</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CluedIn.Core.Accounts</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CluedIn.Core.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CluedIn.Core.DataStore</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CluedIn.Core.Processing</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">CluedIn.DataStore.Exceptions</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">EntityFramework.Extensions</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">CluedIn.DataStore.Relational.PrimaryDataStore</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">PrimaryRelationalDataStore</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">EntityDataStore</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">IPrimaryEntityDataStore</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
        <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">Entity</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">PrimaryRelationalDataStore</span><span class="p">([</span><span class="n">NotNull</span><span class="p">]</span> <span class="n">ApplicationContext</span> <span class="n">context</span><span class="p">)</span>
            <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">DataShardType</span><span class="p">.</span><span class="n">Data</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

       <span class="c1">/// &lt;summary&gt;Creates the connection manager.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;typeparam name="TConnection"&gt;The type of the connection.&lt;/typeparam&gt;</span>
        <span class="c1">/// &lt;param name="organization"&gt;The organization.&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;The connection manager.&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="n">IDataStoreConnectionManager</span><span class="p">&lt;</span><span class="n">TConnection</span><span class="p">&gt;</span> <span class="n">CreateConnectionManager</span><span class="p">&lt;</span><span class="n">TConnection</span><span class="p">&gt;(</span><span class="n">IOrganization</span> <span class="n">organization</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">IDataStoreConnectionManager</span><span class="p">&lt;</span><span class="n">TConnection</span><span class="p">&gt;)</span><span class="k">new</span> <span class="n">RelationalConnectionManager</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;(</span><span class="n">organization</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="n">IProcessedEntity</span> <span class="nf">GetProcessedEntityById</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetById</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="n">TQuery</span> <span class="n">CreateQuery</span><span class="p">&lt;</span><span class="n">TQuery</span><span class="p">&gt;(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotSupportedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="n">T</span> <span class="nf">GetByEntityCode</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEntityCode</span> <span class="n">entityCode</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">simple</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;().</span><span class="nf">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span> <span class="p">==</span> <span class="n">entityCode</span><span class="p">.</span><span class="n">Key</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Entity</span><span class="p">).</span><span class="nf">FirstOrDefault</span><span class="p">();</span>

                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">simple</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">simple</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="nf">VerifyContextOrganization</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnauthorizedAccessException</span><span class="p">();</span>

                <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">EntityWithEntityCodeExists</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEntityCode</span> <span class="n">entityCode</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;().</span><span class="nf">Any</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span> <span class="p">==</span> <span class="n">entityCode</span><span class="p">.</span><span class="n">Key</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="n">IEntityCode</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;</span> <span class="nf">EntitiesWithEntityCodesExists</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">IEntityCode</span><span class="p">&gt;</span> <span class="n">entityCodes</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">codes</span> <span class="p">=</span> <span class="n">entityCodes</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Key</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">existingCodes</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;()</span>
                                        <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">codes</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">Code</span><span class="p">))</span>
                                        <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span><span class="p">)</span>
                                        <span class="p">.</span><span class="nf">ToHashSet</span><span class="p">();</span>

                <span class="k">return</span> <span class="n">entityCodes</span><span class="p">.</span><span class="nf">ToDictionary</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">,</span> <span class="n">c</span> <span class="p">=&gt;</span> <span class="n">existingCodes</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">Key</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">EntityWithIdExists</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;().</span><span class="nf">Any</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">EntityId</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Creates the data store.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">CreateDataStore</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="nf">CreateIfNotExists</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Deletes the data store.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">DeleteDataStore</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="k">try</span>
                <span class="p">{</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="nf">Delete</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnableToDeleteDataStoreException</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Gets the entity by identifier.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="id"&gt;The identifier.&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;The entity with the specified id.&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="n">T</span> <span class="nf">GetById</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">simple</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>

                <span class="k">return</span> <span class="n">simple</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">simple</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Queries the data store.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="predicate"&gt;The predicate.&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;The results of the query.&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">Select</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Expression</span><span class="p">&lt;</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;&gt;</span> <span class="n">predicate</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotSupportedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Queries the data store asynchronously.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="predicate"&gt;The predicate.&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;The results of the query.&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;</span> <span class="nf">SelectAsync</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Expression</span><span class="p">&lt;</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;&gt;</span> <span class="n">predicate</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="k">default</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;));</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;inheritdoc /&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Any</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Expression</span><span class="p">&lt;</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;&gt;</span> <span class="n">predicate</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Inserts the specified context.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="entity"&gt;The entity.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Insert</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">T</span> <span class="n">entity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">VerifyEntityContext</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">entry</span> <span class="p">=</span> <span class="n">SimpleEntity</span><span class="p">.</span><span class="nf">FromEntity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Attach</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">code</span> <span class="k">in</span> <span class="n">entry</span><span class="p">.</span><span class="n">EntityCodes</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;().</span><span class="nf">Attach</span><span class="p">(</span><span class="n">code</span><span class="p">);</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">code</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Added</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="n">dataContext</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">entry</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Added</span><span class="p">;</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Add</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>

                <span class="c1">//foreach (var edge in entity.IncomingEdges)</span>
                <span class="c1">//{</span>
                <span class="c1">//    InsertRelationshipInternal(entity, edge, dataContext);</span>
                <span class="c1">//}</span>

                <span class="c1">//foreach (var edge in entity.OutgoingEdges)</span>
                <span class="c1">//{</span>
                <span class="c1">//    InsertRelationshipInternal(entity, edge, dataContext);</span>
                <span class="c1">//}</span>

                <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Inserts the specified object.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="objects"&gt;The objects.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Insert</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">objects</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">objects</span><span class="p">.</span><span class="nf">All</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">VerifyEntityContext</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">context</span><span class="p">)))</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">SecurityException</span><span class="p">(</span><span class="s">"Cannot insert data for a different security context."</span><span class="p">);</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">o</span> <span class="k">in</span> <span class="n">objects</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">Insert</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Inserts or updates the specified objects.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="entity"&gt;The object.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">InsertOrUpdate</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">T</span> <span class="n">entity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">VerifyEntityContext</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="n">Action</span> <span class="n">action</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">entry</span> <span class="p">=</span> <span class="n">SimpleEntity</span><span class="p">.</span><span class="nf">FromEntity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>

                    <span class="kt">var</span> <span class="n">existing</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Any</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">entity</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">existing</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;().</span><span class="nf">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">EntityId</span> <span class="p">==</span> <span class="n">entity</span><span class="p">.</span><span class="n">Id</span><span class="p">).</span><span class="nf">Delete</span><span class="p">();</span>

                        <span class="n">entry</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Attach</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
                        <span class="n">dataContext</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">entry</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Modified</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="n">entry</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Attach</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
                        <span class="n">dataContext</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">entry</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Added</span><span class="p">;</span>
                        <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Add</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">code</span> <span class="k">in</span> <span class="n">entry</span><span class="p">.</span><span class="n">EntityCodes</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;().</span><span class="nf">Attach</span><span class="p">(</span><span class="n">code</span><span class="p">);</span>
                        <span class="n">dataContext</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">code</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Added</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
                <span class="p">};</span>

                <span class="n">action</span><span class="p">.</span><span class="nf">ExecuteWithRetry</span><span class="p">(</span>
                    <span class="n">isTransient</span><span class="p">:</span> <span class="n">ex</span> <span class="p">=&gt;</span>
                        <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">ex</span> <span class="k">is</span> <span class="n">UpdateException</span><span class="p">)</span>
                                <span class="k">return</span> <span class="n">SqlExceptionHelper</span><span class="p">.</span><span class="nf">IsDuplicateViolation</span><span class="p">((</span><span class="n">UpdateException</span><span class="p">)</span><span class="n">ex</span><span class="p">);</span>

                            <span class="k">if</span> <span class="p">(</span><span class="n">ex</span> <span class="k">is</span> <span class="n">DbUpdateException</span><span class="p">)</span>
                                <span class="k">return</span> <span class="n">SqlExceptionHelper</span><span class="p">.</span><span class="nf">IsDuplicateViolation</span><span class="p">((</span><span class="n">DbUpdateException</span><span class="p">)</span><span class="n">ex</span><span class="p">);</span>

                            <span class="k">if</span> <span class="p">(</span><span class="n">ex</span> <span class="k">is</span> <span class="n">SqlException</span><span class="p">)</span>
                                <span class="k">return</span> <span class="n">SqlExceptionHelper</span><span class="p">.</span><span class="nf">IsDuplicateViolation</span><span class="p">((</span><span class="n">SqlException</span><span class="p">)</span><span class="n">ex</span><span class="p">);</span>

                            <span class="k">if</span> <span class="p">(</span><span class="n">ex</span> <span class="k">is</span> <span class="n">ConstraintException</span><span class="p">)</span>
                                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

                            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                        <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Save</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="n">Task</span> <span class="nf">SaveAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Inserts or updates the specified objects.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="objects"&gt;The objects.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">InsertOrUpdate</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">objects</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">objects</span><span class="p">.</span><span class="nf">All</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">VerifyEntityContext</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">context</span><span class="p">)))</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">SecurityException</span><span class="p">(</span><span class="s">"Cannot insert or update data for a different security context."</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">o</span> <span class="k">in</span> <span class="n">objects</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;().</span><span class="nf">Add</span><span class="p">(</span><span class="n">o</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Updates the specified object.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="entity"&gt;The object.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">T</span> <span class="n">entity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">VerifyEntityContext</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">entry</span> <span class="p">=</span> <span class="n">SimpleEntity</span><span class="p">.</span><span class="nf">FromEntity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
                <span class="n">entry</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Attach</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">entry</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Modified</span><span class="p">;</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Deletes the specified context.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="entity"&gt;The entity.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Delete</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">T</span> <span class="n">entity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">VerifyEntityContext</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">entry</span> <span class="p">=</span> <span class="n">SimpleEntity</span><span class="p">.</span><span class="nf">FromEntity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Attach</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Remove</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Deletes the specified object.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="objects"&gt;The objects.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Delete</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">objects</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">objects</span><span class="p">.</span><span class="nf">All</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">VerifyEntityContext</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">context</span><span class="p">)))</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">SecurityException</span><span class="p">(</span><span class="s">"Cannot delete data for a different security context."</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">obj</span> <span class="k">in</span> <span class="n">objects</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>

                <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Queries the data store.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="predicate"&gt;The predicate.&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;The results of the query.&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">virtual</span> <span class="kt">decimal</span><span class="p">?</span> <span class="nf">GetUsage</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Expression</span><span class="p">&lt;</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">decimal</span><span class="p">?&gt;&gt;</span> <span class="n">predicate</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Sum</span><span class="p">(</span><span class="n">predicate</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Deletes the object with the specified id.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="id"&gt;The identifier.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">DeleteById</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">DeleteById</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Deletes the by identifier.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="id"&gt;The identifier.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="version"&gt;The version.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">DeleteById</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span><span class="p">?</span> <span class="n">version</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityEdge</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">FromEntityId</span> <span class="p">==</span> <span class="n">id</span><span class="p">).</span><span class="nf">Delete</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityEdge</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">ToEntityId</span> <span class="p">==</span> <span class="n">id</span><span class="p">).</span><span class="nf">Delete</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">EntityId</span> <span class="p">==</span> <span class="n">id</span><span class="p">).</span><span class="nf">Delete</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">).</span><span class="nf">Delete</span><span class="p">();</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;Deletes all objects.&lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="context"&gt;The context.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="canBeSystemContext"&gt;if set to &lt;c&gt;true&lt;/c&gt; [can be system context].&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">DeleteAll</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">canBeSystemContext</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">SelectMany</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">IncomingEdges</span><span class="p">).</span><span class="nf">Delete</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">SelectMany</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">OutgoingEdges</span><span class="p">).</span><span class="nf">Delete</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">SelectMany</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">EntityCodes</span><span class="p">).</span><span class="nf">Delete</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Delete</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">VerifyEntityContext</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;(</span><span class="n">TEntity</span> <span class="n">entity</span><span class="p">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Organization</span> <span class="p">==</span> <span class="n">context</span><span class="p">.</span><span class="n">ApplicationContext</span><span class="p">.</span><span class="n">System</span><span class="p">.</span><span class="n">Organization</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="nf">VerifyContextOrganization</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="nf">VerifyContextUser</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;</span> <span class="n">FilterEntitySet</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;(</span><span class="n">DbSet</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;</span> <span class="k">set</span><span class="p">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span> <span class="k">where</span> <span class="n">TEntity</span> <span class="p">:</span> <span class="k">class</span>
        <span class="err">{</span>
            <span class="nc">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Organization</span> <span class="p">==</span> <span class="n">context</span><span class="p">.</span><span class="n">ApplicationContext</span><span class="p">.</span><span class="n">System</span><span class="p">.</span><span class="n">Organization</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">set</span><span class="p">;</span>

            <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;</span> <span class="n">filter</span> <span class="p">=</span> <span class="k">set</span><span class="p">;</span>

            <span class="n">filter</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterByContextOrganization</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
            <span class="n">filter</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterByContextUser</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">filter</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;</span> <span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">DbSet</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;</span> <span class="k">set</span><span class="p">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Organization</span> <span class="p">==</span> <span class="n">context</span><span class="p">.</span><span class="n">ApplicationContext</span><span class="p">.</span><span class="n">System</span><span class="p">.</span><span class="n">Organization</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">set</span><span class="p">;</span>

            <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;</span> <span class="n">filter</span> <span class="p">=</span> <span class="k">set</span><span class="p">;</span>

            <span class="n">filter</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterByContextOrganization</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
            <span class="n">filter</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterByContextUser</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">filter</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/**********************************************************************************************************
         * 
         **********************************************************************************************************/</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">VerifyContextOrganization</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;(</span><span class="n">TEntity</span> <span class="n">entity</span><span class="p">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">f</span> <span class="p">=</span> <span class="n">entity</span> <span class="k">as</span> <span class="n">IOrganizationContextFilteredEntity</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">OrganizationId</span> <span class="p">!=</span> <span class="n">context</span><span class="p">.</span><span class="n">Organization</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">SecurityException</span><span class="p">(</span><span class="s">"Cannot access data from a different security context"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">VerifyContextUser</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;(</span><span class="n">TEntity</span> <span class="n">entity</span><span class="p">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Identity</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">f</span> <span class="p">=</span> <span class="n">entity</span> <span class="k">as</span> <span class="n">IUserContextFilteredEntity</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">UserId</span> <span class="p">!=</span> <span class="n">context</span><span class="p">.</span><span class="n">Identity</span><span class="p">.</span><span class="n">UserId</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">SecurityException</span><span class="p">(</span><span class="s">"Cannot access data from a different security context"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;</span> <span class="n">FilterByContextOrganization</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;(</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;</span> <span class="k">set</span><span class="p">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">set</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;</span> <span class="nf">FilterByContextOrganization</span><span class="p">(</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;</span> <span class="k">set</span><span class="p">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">set</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">OrganizationId</span> <span class="p">==</span> <span class="n">context</span><span class="p">.</span><span class="n">Organization</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;</span> <span class="n">FilterByContextUser</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;(</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">TEntity</span><span class="p">&gt;</span> <span class="k">set</span><span class="p">,</span> <span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">set</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>

        <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>

        <span class="k">public</span> <span class="n">T</span> <span class="nf">GetByEntityCode</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">IEntityCode</span><span class="p">&gt;</span> <span class="n">codes</span><span class="p">,</span> <span class="kt">bool</span><span class="p">?</span> <span class="n">ignoreDuplicates</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">keys</span> <span class="p">=</span> <span class="n">codes</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Key</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">simple</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;().</span><span class="nf">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">keys</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">i</span> <span class="p">=&gt;</span> <span class="n">i</span> <span class="p">==</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span><span class="p">)).</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Entity</span><span class="p">).</span><span class="nf">FirstOrDefault</span><span class="p">();</span>

                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">simple</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">simple</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="nf">VerifyContextOrganization</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnauthorizedAccessException</span><span class="p">();</span>

                <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">GetEntitiesByEntityCodes</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">IEntityCode</span><span class="p">&gt;</span> <span class="n">codes</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">keys</span> <span class="p">=</span> <span class="n">codes</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Key</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">simple</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;().</span><span class="nf">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">keys</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">i</span> <span class="p">=&gt;</span> <span class="n">i</span> <span class="p">==</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span><span class="p">)).</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Entity</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">simple</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">e</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">)).</span><span class="nf">ToList</span><span class="p">();</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">r</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="nf">VerifyContextOrganization</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnauthorizedAccessException</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Guid</span><span class="p">?</span> <span class="nf">GetEntityIdByEntityCode</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEntityCode</span> <span class="n">code</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">simple</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityCode</span><span class="p">&gt;().</span><span class="nf">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span> <span class="p">==</span> <span class="n">code</span><span class="p">.</span><span class="n">Key</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Entity</span><span class="p">).</span><span class="nf">FirstOrDefault</span><span class="p">();</span>

                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">simple</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">simple</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="nf">VerifyContextOrganization</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnauthorizedAccessException</span><span class="p">();</span>

                <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">GetEntities</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="kt">int</span> <span class="n">page</span><span class="p">,</span> <span class="kt">int</span> <span class="n">take</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Skip</span><span class="p">((</span><span class="n">page</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">*</span> <span class="n">take</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="n">take</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">entry</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">GetEntities</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">EntityType</span> <span class="n">entityType</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">EntityType</span> <span class="p">==</span> <span class="n">entityType</span><span class="p">.</span><span class="n">Code</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">entry</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">GetEntities</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">EntityType</span> <span class="n">entityType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">page</span><span class="p">,</span> <span class="kt">int</span> <span class="n">take</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">).</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">EntityType</span> <span class="p">==</span> <span class="n">entityType</span><span class="p">.</span><span class="n">Code</span><span class="p">).</span><span class="nf">Skip</span><span class="p">((</span><span class="n">page</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">*</span> <span class="n">take</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="n">take</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">entry</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">DuplicateEntityGrouping</span><span class="p">&gt;</span> <span class="nf">GetDuplicateEntities</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">DuplicateEntityGrouping</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">DuplicateEntityGrouping</span><span class="p">&gt;</span> <span class="nf">GetDuplicateEntities</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">entity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">DuplicateEntityGrouping</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;</span> <span class="nf">FindByNames</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">EntityType</span><span class="p">&gt;</span> <span class="n">entityTypes</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">names</span><span class="p">,</span> <span class="kt">int</span> <span class="n">maxResults</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">EntityEdge</span><span class="p">&gt;</span> <span class="nf">GetIncomingRelationships</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">EntityEdge</span><span class="p">&gt;</span> <span class="nf">GetIncomingRelationships</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">page</span><span class="p">,</span> <span class="kt">int</span> <span class="n">take</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">EntityEdge</span><span class="p">&gt;</span> <span class="nf">GetOutgoingRelationships</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">EntityEdge</span><span class="p">&gt;</span> <span class="nf">GetOutgoingRelationships</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">page</span><span class="p">,</span> <span class="kt">int</span> <span class="n">take</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;</span> <span class="nf">GetIncomingRelationshipEndpoints</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">edgeType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">page</span><span class="p">,</span> <span class="kt">int</span> <span class="n">take</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">SelectMany</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">IncomingEdges</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">EdgeType</span> <span class="p">==</span> <span class="n">edgeType</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="n">page</span> <span class="p">*</span> <span class="m">20</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="n">take</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">entry</span><span class="p">.</span><span class="n">FromEntity</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;</span> <span class="nf">GetIncomingRelationshipEndpoints</span><span class="p">(</span>
            <span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span>
            <span class="n">Guid</span> <span class="n">id</span><span class="p">,</span>
            <span class="kt">string</span> <span class="n">edgeType</span><span class="p">,</span>
            <span class="kt">string</span> <span class="n">entityType</span><span class="p">,</span>
            <span class="kt">int</span> <span class="n">page</span><span class="p">,</span>
            <span class="kt">int</span> <span class="n">take</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">SelectMany</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">IncomingEdges</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">EdgeType</span> <span class="p">==</span> <span class="n">edgeType</span> <span class="p">&amp;&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">FromEntity</span><span class="p">.</span><span class="n">EntityType</span> <span class="p">==</span> <span class="n">entityType</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="n">page</span> <span class="p">*</span> <span class="m">20</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="n">take</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">entry</span><span class="p">.</span><span class="n">FromEntity</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;</span> <span class="nf">GetOutgoingRelationshipEndpoints</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">edgeType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">page</span><span class="p">,</span> <span class="kt">int</span> <span class="n">take</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">SelectMany</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">OutgoingEdges</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">EdgeType</span> <span class="p">==</span> <span class="n">edgeType</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="n">page</span> <span class="p">*</span> <span class="m">20</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="n">take</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="n">entry</span><span class="p">.</span><span class="n">FromEntity</span><span class="p">.</span><span class="nf">ToEntity</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">HasRelationship</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">T</span> <span class="n">first</span><span class="p">,</span> <span class="n">T</span> <span class="n">second</span><span class="p">,</span> <span class="kt">string</span> <span class="n">relationshipType</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nf">FilterEntitySet</span><span class="p">(</span><span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityEdge</span><span class="p">&gt;(),</span> <span class="n">context</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">FromEntityId</span> <span class="p">==</span> <span class="n">first</span><span class="p">.</span><span class="n">Id</span> <span class="p">&amp;&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">ToEntityId</span> <span class="p">==</span> <span class="n">second</span><span class="p">.</span><span class="n">Id</span> <span class="p">&amp;&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">EdgeType</span> <span class="p">==</span> <span class="n">relationshipType</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">InsertRelationship</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">T</span> <span class="n">contextEntity</span><span class="p">,</span> <span class="n">EntityEdge</span> <span class="n">edge</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">InsertRelationship</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">contextEntity</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">InsertRelationship</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">T</span> <span class="n">contextEntity</span><span class="p">,</span> <span class="n">EntityEdge</span> <span class="n">edge</span><span class="p">,</span> <span class="kt">bool</span><span class="p">?</span> <span class="n">ignoreDuplicates</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">VerifyEntityContext</span><span class="p">(</span><span class="n">contextEntity</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="nf">InsertRelationshipInternal</span><span class="p">(</span><span class="n">contextEntity</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">dataContext</span><span class="p">);</span>
                <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">InsertRelationshipInternal</span><span class="p">(</span><span class="n">T</span> <span class="n">contextEntity</span><span class="p">,</span> <span class="n">EntityEdge</span> <span class="n">edge</span><span class="p">,</span> <span class="n">DbContext</span> <span class="n">dataContext</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">FromReference</span><span class="p">.</span><span class="nf">IsReferenceTo</span><span class="p">(</span><span class="n">contextEntity</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">ids</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">EntityCodes</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span> <span class="p">==</span> <span class="n">edge</span><span class="p">.</span><span class="n">ToReference</span><span class="p">.</span><span class="n">Code</span><span class="p">.</span><span class="n">Key</span><span class="p">)).</span><span class="nf">Select</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">id</span> <span class="k">in</span> <span class="n">ids</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">entry</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SimpleEntityEdge</span><span class="p">()</span>
                                    <span class="p">{</span>
                                        <span class="n">FromEntityId</span> <span class="p">=</span> <span class="n">contextEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
                                        <span class="n">ToEntityId</span> <span class="p">=</span> <span class="n">id</span><span class="p">,</span>
                                        <span class="n">EdgeType</span> <span class="p">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">EdgeType</span><span class="p">,</span>
                                        <span class="n">EdgeData</span> <span class="p">=</span> <span class="k">null</span>
                                    <span class="p">};</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityEdge</span><span class="p">&gt;().</span><span class="nf">Add</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">ToReference</span><span class="p">.</span><span class="nf">IsReferenceTo</span><span class="p">(</span><span class="n">contextEntity</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">ids</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntity</span><span class="p">&gt;().</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">EntityCodes</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span> <span class="p">==</span> <span class="n">edge</span><span class="p">.</span><span class="n">FromReference</span><span class="p">.</span><span class="n">Code</span><span class="p">.</span><span class="n">Key</span><span class="p">)).</span><span class="nf">Select</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">id</span> <span class="k">in</span> <span class="n">ids</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">entry</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SimpleEntityEdge</span><span class="p">()</span>
                                    <span class="p">{</span>
                                        <span class="n">ToEntityId</span> <span class="p">=</span> <span class="n">contextEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
                                        <span class="n">FromEntityId</span> <span class="p">=</span> <span class="n">id</span><span class="p">,</span>
                                        <span class="n">EdgeType</span> <span class="p">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">EdgeType</span><span class="p">,</span>
                                        <span class="n">EdgeData</span> <span class="p">=</span> <span class="k">null</span>
                                    <span class="p">};</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityEdge</span><span class="p">&gt;().</span><span class="nf">Add</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">contextEntity</span><span class="p">.</span><span class="n">IsDeleted</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">contextEntity</span><span class="p">.</span><span class="n">IsDeleted</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="p">||</span> <span class="n">contextEntity</span><span class="p">.</span><span class="n">ProcessedData</span><span class="p">.</span><span class="n">OriginEntityCode</span><span class="p">.</span><span class="n">Type</span><span class="p">.</span><span class="nf">Is</span><span class="p">(</span><span class="s">"/Deleted"</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"The edge to be inserted doesn't reference the context entity. ContextEntity: {0} Edge: {1}"</span><span class="p">.</span><span class="nf">FormatWith</span><span class="p">(</span><span class="n">contextEntity</span><span class="p">.</span><span class="n">ProcessedData</span><span class="p">.</span><span class="n">OriginEntityCode</span><span class="p">,</span> <span class="n">edge</span><span class="p">),</span> <span class="k">nameof</span><span class="p">(</span><span class="n">edge</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">DeleteRelationship</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">T</span> <span class="n">entity</span><span class="p">,</span> <span class="n">EntityEdge</span> <span class="n">edge</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">VerifyEntityContext</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dataContext</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">CreateDbContext</span><span class="p">&lt;</span><span class="n">PrimaryDataStoreModel</span><span class="p">&gt;())</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">FromReference</span><span class="p">.</span><span class="nf">IsReferenceTo</span><span class="p">(</span><span class="n">entity</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityEdge</span><span class="p">&gt;().</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">FromEntityId</span> <span class="p">==</span> <span class="n">entity</span><span class="p">.</span><span class="n">Id</span> <span class="p">&amp;&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">EdgeType</span> <span class="p">==</span> <span class="n">edge</span><span class="p">.</span><span class="n">EdgeType</span> <span class="p">&amp;&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">ToEntity</span><span class="p">.</span><span class="n">EntityCodes</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span> <span class="p">==</span> <span class="n">edge</span><span class="p">.</span><span class="n">ToReference</span><span class="p">.</span><span class="n">Code</span><span class="p">.</span><span class="n">Key</span><span class="p">)).</span><span class="nf">Delete</span><span class="p">();</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">ToReference</span><span class="p">.</span><span class="nf">IsReferenceTo</span><span class="p">(</span><span class="n">entity</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">SimpleEntityEdge</span><span class="p">&gt;().</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">ToEntityId</span> <span class="p">==</span> <span class="n">entity</span><span class="p">.</span><span class="n">Id</span> <span class="p">&amp;&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">EdgeType</span> <span class="p">==</span> <span class="n">edge</span><span class="p">.</span><span class="n">EdgeType</span> <span class="p">&amp;&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">FromEntity</span><span class="p">.</span><span class="n">EntityCodes</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Code</span> <span class="p">==</span> <span class="n">edge</span><span class="p">.</span><span class="n">ToReference</span><span class="p">.</span><span class="n">Code</span><span class="p">.</span><span class="n">Key</span><span class="p">)).</span><span class="nf">Delete</span><span class="p">();</span>
                    <span class="n">dataContext</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">entity</span><span class="p">.</span><span class="n">IsDeleted</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span>  <span class="n">entity</span><span class="p">.</span><span class="n">IsDeleted</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="p">||</span> <span class="n">entity</span><span class="p">.</span><span class="n">ProcessedData</span><span class="p">.</span><span class="n">OriginEntityCode</span><span class="p">.</span><span class="n">Type</span><span class="p">.</span><span class="nf">Is</span><span class="p">(</span><span class="s">"/Deleted"</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span> <span class="c1">// Ignore</span>
                <span class="p">}</span>
                <span class="k">else</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"The edge to be inserted doesn't reference the context entity. ContextEntity: {0} Edge: {1}"</span><span class="p">.</span><span class="nf">FormatWith</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">ProcessedData</span><span class="p">.</span><span class="n">OriginEntityCode</span><span class="p">,</span> <span class="n">edge</span><span class="p">),</span> <span class="k">nameof</span><span class="p">(</span><span class="n">edge</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">EntityAggregatedParents</span> <span class="nf">GetCachedParents</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">EntityAggregatedParents</span><span class="p">&gt;</span> <span class="nf">GetCachedParents</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Guid</span><span class="p">&gt;</span> <span class="n">ids</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="n">ExecutionContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">EntityAggregatedParents</span> <span class="n">entityParents</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You will then need to update your container.config to include the switch to tell the Entity Framework to use your other database.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   		<span class="nt">&lt;connectionStrings&gt;</span>
            <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">"MyContext"</span> <span class="na">providerName=</span><span class="s">"MySql.Data.MySqlClient"</span> 
                <span class="na">connectionString=</span><span class="s">"server=localhost;port=3306;database=mycontext;uid=root;password=********"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/connectionStrings&gt;</span>
        <span class="nt">&lt;entityFramework&gt;</span>
            <span class="nt">&lt;defaultConnectionFactory</span> <span class="na">type=</span><span class="s">"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;providers&gt;</span>
                <span class="nt">&lt;provider</span> <span class="na">invariantName=</span><span class="s">"MySql.Data.MySqlClient"</span> 
                    <span class="na">type=</span><span class="s">"MySql.Data.MySqlClient.MySqlProviderServices, MySql.Data.Entity.EF6"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;provider</span> <span class="na">invariantName=</span><span class="s">"System.Data.SqlClient"</span> 
                    <span class="na">type=</span><span class="s">"System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/providers&gt;</span>
        <span class="nt">&lt;/entityFramework&gt;</span>
</code></pre></div></div>

			</article>
				<aside id="sticky-menu">
					<ul>
							<li>
									For version 3.2
							</li>
						<li>
								<a
									target="__blank"
									rel="noopener"
									href="/tree/master/_docs/91-Developer-Portal/40-Datastores/Switching a Datastore Provider.md"
								>
									<i class="fab fa-github"></i>
									Edit this page
								</a>
						</li>
						<li>
								<a
									target="__blank"
									rel="noopener"
									href="https://twitter.com/CluedInHQ"
								>
									<i class="fab fa-twitter"></i>
									Follow us
								</a>
						</li>
						<li>
								<a
									target="__blank"
									rel="noopener"
									href="https://www.facebook.com/cluedinhq/"
								>
									<i class="fab fa-facebook"></i>
									Like us
								</a>
						</li>
						<li>
								<a
									target="__blank"
									rel="noopener"
									href="https://www.linkedin.com/company/cluedin-aps/"
								>
									<i class="fab fa-linkedin-in"></i>
									LinkedIn
								</a>
						</li>
						<li>
								<a
									target="__blank"
									rel="noopener"
									href="https://vimeo.com/cluedin"
								>
									<i class="fab fa-vimeo"></i>
									Vimeo
								</a>
						</li>
						<li>
								<a
									target="__blank"
									rel="noopener"
									href="https://www.youtube.com/channel/UC3jeVGsDC97C81ISJLUhszQ"
								>
									<i class="fab fa-youtube"></i>
									Subscribe
								</a>
						</li>
					</ul>
				</aside>
			</main>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>

    <script async src="https://documentation.cluedin.net/versions/3.2.3/scripts/prism.js"></script>
	</body>
</html>
